## 用改进的Faster-RCNN和Feature Pyramid网络检测PCB表面缺陷

​		缺陷检测是印刷电路板（PCBs）生产中质量控制的一个基本要求。传统的缺陷检测方法有各种缺点，如强烈依赖精心设计的模板、计算成本高、易受噪音影响等，这些缺点在生产环境中构成了巨大挑战。本文提出了一种基于深度学习的图像检测方法用于PCB缺陷检测。该方法建立了一个基于Faster RCNN的新网络。我们使用带有特征金字塔网络的ResNet50作为特征提取的骨干，以更好地检测PCB上的小缺陷。其次，我们使用GARPN来预测更准确的锚点，并合并ShuffleNetV2的剩余单元。实验结果表明，这种方法比其他PCB缺陷检测方法更适合在生产中使用。我们还在其他PCB缺陷数据集中进行了测试，实验表明，这种方法同样有效。

​		III. PCB缺陷和检测网络

在本节中，我们观察和分析了PCB缺陷的特点，并针对这些特点提出了一个新颖的缺陷检测网络。我们将介绍该网络的整体架构，并详细介绍其核心部分：残损单元和多尺度区域建议。最后，我们将介绍该网络的工业部署。

​		A. PCB缺陷 我们在研究中主要关注六种常见的PCB缺陷：(a)开路，(b)短路，(c)老鼠咬伤，(d)刺穿，(e)针孔，(f)焊球，如图3所示。首先，缺陷往往只占PCB的一小部分。其次，不同的机制导致这些缺陷，从而表现出不同的特征，主要包括（颜色特征、形状特征、区域特征）。

​		例如，与正常模式相比，短路模式减少了图像中包含的区域数量。同样，对于开路模式，区域的数量也会增加。老鼠咬痕是指蚀刻后线路边缘的不规则缺口，就像被老鼠咬了一口。针孔是由于氢气在镀件表面的吸附，不会慢慢释放出来。镀液不能润湿镀件的表面，所以电镀层不能被电解。随着氢气演化点周围涂层厚度的增加，在氢气演化点形成一个针孔，其特征是一个闪亮的圆孔，有时会有一个向上的小尾巴。焊球会因为突起而缩小导线之间的距离。我们需要针对这些特点设计一个合理的网络。

		B. 结构概述 

​        ==与传统的卷积神经网络只使用强语义信息相比，我们提出的方法还利用了包含弱特征的详细信息，由于PCB缺陷经常以不同的属性出现。因此，我们调整了多尺度特征，以融合来自多尺度背景的信息。整个网络框架如图4所示。模型的输入是一个RGB格式的图像。我们采用Faster RCNN作为检测器，ResNet50[19]作为骨干。我们将特征金字塔网络（FPN）应用于特征提取部分，以合并深层特征和浅层特征，这也可以提高小缺陷检测的准确性。由于使用了较深的网络ResNet50，我们使用Shuffle V2残差单元来代替基本残差单元，以减少整个网络的计算量。进一步，我们使用GARPN来获得更准确的区域建议，减少不必要的锚点，然后使用ROI池来获得对象建议。之后，使用全连接层进行分类和边界盒回归，达到最终的缺陷检测结果。==



C. 特征提取 

FPN在不同尺度上生成具有强大语义信息的特征金字塔，以获得小物体上更多有用的细节，而不明显增加计算量和占用的内存，这样就可以极大地提高检测小缺陷的准确性。它使用卷积神经网络来生成一组分层特征，在金字塔的不同尺度上编码语义信息。这个分层金字塔中的不同层次的特征代表了图像中的物体和它们在不同视图中的背景信息。在我们的网络中，我们使用conv2、conv3、conv4和conv5块，从骨架上建立金字塔模型的特征图。

conv1不包括在内的原因是它离输入数据太近，而且内存占用巨大。我们选择每个区块的最后一个残差单元的输出作为自下而上的特征图，通过对空间分辨率进行2×的上采样构建自上而下的特征图，表示为M2、M3、M4、M5，分别对应conv2、conv3、conv4、conv5。在相应的自下而上的特征图被1×1卷积，以减少通道的大小，并将上采样的图逐一加入到相应的自下而上的图中。浅层特征图由于没有经过多次下采样，所以包含更准确的定位信息，[2]。最后，在每个合并的地图上附加一个3×3的卷积层，生成最终的特征图。目的是为了消除上采样的混叠效应。最后一组特征图表示为P2、P3、P4和P5，分别对应conv2、conv3、conv4和conv5，它们的空间大小相同，但语义信息更多，如图5所示。与原始的RPN[20]不同，在RPN中，分类和边界框回归只在单一尺度的信号尺度上进行，在我们的网络中，RPN将多尺度特征作为输入。我们将在下面的小节中讨论它。