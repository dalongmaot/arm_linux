# 基于深度学习的工业印刷电路板X射线图像焊点缺陷检测



### 摘要

​		随着电子电路生产方法的改进，例如元件尺寸的减小和元件密度的增加，生产线中出现缺陷的风险越来越大。检查失效焊点的技术有很多，如X射线成像、光学成像和热成像，其中X射线成像可以检查外部和内部缺陷。然而，一些先进的算法不够精确，无法满足质量控制的要求。需要大量的手动检查，这增加了专家的工作量。此外，自动X射线检查可能会产生不正确的感兴趣区域，从而恶化缺陷检测。X射线图像的高维性和图像大小的变化也对检测算法提出了挑战。最近，深度学习的最新进展为基于图像的任务提供了灵感，并与人类水平相竞争。在这项工作中，在质量控制检查中引入了深度学习。提出并比较了四种基于人工智能的联合缺陷检测模型。讨论了噪声ROI和图像尺寸变化问题。通过在真实三维X射线数据集上的实验验证了所提出模型的有效性，大大节省了专家检查工作量。

​					**关键词**：  联合缺陷检测      深度学习      自动X射线检测        质量控制



### 引言

​			随着电子电路生产方法的改进，手机和笔记本电脑等电子产品的生产速度也在提高。同时，在印刷电路板（PCB）装配过程中，由于元件尺寸的减小和元件密度的增加，缺陷的风险增加^[1]^。因此，高效准确的质量控制系统至关重要。

​		结构缺陷是组装电路板中的主要缺陷类型之一，包括焊料不足、空洞和短路^[2]^。借助自动检测方法，减少了人工工作量，减轻了专家主观判断和专家疲劳带来的错误。基于成像的自动检测方法，如光学成像和热成像，通常用于生产线的质量控制^[3–6]^。

​		与光学和热成像相比，X射线成像不仅能更好地反映外部缺陷，而且能更好地反映内部缺陷。简单地说，焊料使用重材料，如银、铜和铅，在X射线下很容易成像，而形成其他组件的轻材料不容易成像。重材料的数量也可以从X射线成像中反映出来。因此，可以在外部和内部的X射线图像上检查焊料质量。因此，**自动X射线检测（AXI(automated X-ray inspection)）**已广泛应用于电子制造业，以监测印刷电路板的质量。例如，可以在2D空间中对X射线图像特征进行建模和可视化，以进行缺陷检测。检测基于可视化缺陷关节特征与正常关节的偏差^[7]^。X射线图像也可以用于三维空间，以形成空间模型。通过比较空间特征，如体积和传播方向，可以过滤出缺陷焊点^[8]^。然而，这种计算机断层扫描图像需要很高的计算复杂度，并且需要时间来检查一个样本。

​		近年来，深度卷积神经网络（CNN）在图像分类和目标检测等许多领域显示出了具有竞争力的性能^[9-11]^。CNN可以有效地提取基于图像的特征。特征提取对于基于成像的方法非常重要，无论是光学成像、热成像还是X射线成像。在焊点检测领域，一些研究侧重于提取准确的特征，并提出了创新的光学图像提取方法，如高等人提出的基于线的聚类方法^[4]^。以及金等人提出的参考自由路径行走方法^[5]^。在基于CNN的方法方面，吴等人提出使用掩码R-CNN方法进行缺陷联合定位和检测^[12]^。Cai等人提议使用三个级联级别的CNN来检测焊点缺陷。随着级别数的增加，性能会变得更好^[13]^。然而，更复杂的级别需要更多的手动标记，并增加了手动工作量。Goto等人提出将对抗卷积自动编码器与传统异常检测方法相结合用于缺陷检测^[14]^。他们的方法在具有八个成像深度的X射线数据集上表现良好。但一些实际问题没有得到解决，例如切片数量变化和X射线图像噪声。在本文中，我们关注缺陷检测问题，以减少手动工作量。在检测过程中解决了实际问题。具体问题公式将在下一节中说明。



### 问题公式

​		在AXI中，先进技术用于焊点定位和检查。当机器检测到缺陷焊点时，会将其发送给专家进行第二轮检查。然而，有时机器检查不准确，这会将大量正常的焊点发送给专家，从而增加手动工作量。研究中很少讨论商品化的AXI机器统计。我们根据获得的真实数据集计算统计数据。**在518292张由AXI机器标记为缺陷的通孔焊接图像中，只有大约15%是由专家标记的真正缺陷。大约85%的焊点是正常的，但也被送往专家进行进一步检查。在这项工作中，主要问题是从错误分类的数据集中检测真实的缺陷焊点，并减少手动工作量。**

​		为了实现这一目标，需要解决两个问题，即**噪声感兴趣区域（ROI( noisy region of interest)）**和可变切片数。目前基于X射线成像的焊料缺陷检测研究很少涉及X射线成像数据集中的噪声。AXI提取的一些ROI不正确，无法包围焊点区域，这会降低焊点缺陷检测。此外，切片的数量也不尽相同。在数据收集过程中忽略了焊料的某些深度，因为这些深度可能不需要人工检查。因此，并非所有焊点的切片数都相同。尽管有一些基于深度学习的方法实现了上述PCB缺陷检测，但很少有研究专注于X射线成像和处理不同数量的切片。一般来说，这些问题可以总结如下：

1、AXI错误呼叫增加了专家工作量。

2、来自AXI的不正确ROI恶化了焊接缺陷检测。

3、切片数量的变化使建模变得困难。

​		在这项工作中，由于深度学习方法适用于高分辨率的基于图像的任务，因此将其纳入其中。我们通过在生产线上提出基于深度学习的检查模块来缓解AXI机器效率低下的问题。三维X射线图像有两种查看方式，这决定了特征提取的方式。第一种方法是分别查看每个切片，并直接从每个切片中提取特征。第二种方法是从所有切片中提取特征，并根据提取的特征进行缺陷检测。

​		提出了两种预处理方法。第一种方法是直接堆叠焊点的每个薄片。第二种方法是将焊点的所有切片处理在一起，并以统计方式对其进行操作。专门设计的预处理方法可以解决不同切片数的问题和不正确的ROI问题。

​		在深度学习结构设计中，提出了**三种基于CNN、3D CNN和长短时记忆（LSTM）的深度学习模型结构，适合预处理方法**。预处理方法和深度学习模型结构的结合产生了四个基于深度学习的模型。由于很少有基于深度学习的方法能解决PCB X射线成像中的不同片数问题和不正确的ROI问题，因此对其性能进行了比较，这有助于对类似问题的研究。我们提出的方法的特点总结如下。

​		——提出了一种人工智能辅助的生产线上的检查，可以大大减少专家的工作量。

​		——解决了X射线成像中的切片数量变化问题和不正确的ROI问题。

​		——激活特征图被提出来用于可视化和分析预处理方法。

​		——提出了三种适合预处理方法的深度学习结构。

​		所提出的方法具有良好的泛化性能，其功效通过在一个非常大的真实世界三维X射线数据集上的实验得到了验证。通过纳入基于人工智能的模型，73.29%的正常关节被过滤掉，只有26.71%的正常关节被送到专家那里检查，这极大地减少了专家的工作量。建议的方法在 "方法 "一节中介绍。这些方法在 "预处理方法 "和 "深度学习模型结构 "部分详细介绍。实验和性能结果在 "实验和结果 "一节中介绍，我们在 "结论 "一节中总结了这项工作。



## 方法论

​		一条电子生产线如图1所示。自动光学检测（AOI）、自动X射线检测（AXI）、在线测试和功能测试是质量控制的常见测试。我们的工作重点是AXI，它基于X射线成像检测缺陷焊点。通常，被AXI检测为缺陷的焊点会被送到专家那里进行后续检查，如图1a所示。

​		![image-20221009100409702](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221009100409702.png)



​															                 （a）生产线上的实时检测

![image-20221009100607980](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221009100607980.png)



​																		（b）建议在生产线上采用人工智能辅助检查

​																				图1  在AXI之后有后续检查的生产线



​		当AXI产生太多的错误呼叫时，专家需要检查许多正常的焊点，这些焊点被错误地归类为缺陷。我们的工作通过引入基于深度学习的方法缓解了AXI的低效率问题。新的流程如图1b所示。对于被AXI检测为缺陷的焊点，它们首先被发送到我们的方法。通过我们的方法检测到的缺陷焊点被送到专家那里，而正常的焊点则被送到下一步测试。



## 3D(三维)自动X射线检测

​		为了更好地理解这些方法的推理，介绍了三维自动X射线检测（AXI）系统的一些背景。

​		三维X射线系统可以在X射线源和检测器同步旋转的情况下，**获得不同深度的PCB成像**。焦点平面上的元件接头会很清晰，而焦点平面以上或以下的元件接头则会很模糊。因此，关于PCB的不同深度的不同切片被获得。这些切片对接头缺陷检测很重要，因为它们显示了接头的隐藏特征。一个有四个切片的例子，见图2。

​		不同的片断是针对不同的模糊程度。虽然片数越多不一定意味着深度越深，但深度和片数是一致的。有一个最大的切片数，这意味着在数据收集过程中，所有深度的成像切片都是由AXI机器收集的。然而，对于某些焊点，所有的片子对专家检查来说是不必要的。因此，收集的切片数量较少。例如，从AXI机器上可以得到最多6个成像切片，即[00, 01, 02, 03, 04, 05]。一个收集的焊点切片只有三个，即[00，01，02]。在我们的案例中，虽然有些焊点片被忽略了，但被忽略的片子总是最后的片子。

​		更多的片子为一个焊点提供更多的信息。然而，标签是根据焊点给出的。也就是说，如果一个焊点的切片是有缺陷的，那么所有的切片都被标记为有缺陷。不可能知道哪些片子是有缺陷的。因此，一个焊点的所有片子需要作为一个输入来处理。而不同的输入有不同数量的片子。

![image-20221009101023410](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221009101023410.png)

​															图2 带有四个切片的三维X射线成像的一个例子



​		与X射线图像一起，AXI还提供了一个被检查的焊点的边界框，称为感兴趣区域（ROI）。ROI由ROI的左上角和右下角的两组坐标组成。理想情况下，ROI不仅提供被检测焊点的位置，而且还提供被检测焊点的面积。然而，有些ROI并不可靠。例如，由于图3a中的ROI尺寸较小，ROI不能包含焊点的整个部分。它应该是一个正方形，短边与长边的长度应该是一样的。或者图3b中的ROI水平移动。ROI的大小是正确的，但是由于移动，ROI不能包括焊点的整个部分。虽然ROI的一条边穿过了焊点，但焊点的大部分区域都在ROI内。

![image-20221009101125031](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221009101125031.png)

​																						        （a）

![image-20221009101918741](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221009101918741.png)

​																										（b）

​																		                   图3 带有ROI的AXI的例子



## 框架提出

​		如图4所示，拟议的框架有两个阶段，即训练阶段和实施阶段。

![image-20221009102218268](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221009102218268.png)

​																						图4 建议的框架

​		在训练阶段，首先对来自机器的原始巨型数据，如焊点类型、电路板类型、ROI和X射线图像文件路径进行解析和准备。同时，基于切片的图像数据被解析为基于焊点的图像数据。然后在模型训练前对图像文件进行预处理。为了减少本应被检测为缺陷焊料的虚假正常焊料，根据经验选择阈值。

​		在实施阶段，新传入的经过解析和预处理的数据被发送到经过训练的模型，并与阈值进行比较。检测到的缺陷被传递给操作人员，以便进一步分析和决策。

​		在这个框架下，提出了四个模型。提出的模型有不同的预处理方法和不同的人工智能模型结构，如表1所示。提出并专门设计了两种预处理方法，即**ROI掩膜预处理**和**通道预处理**。ROI掩膜预处理方法将一个焊点的所有切片放在一起，并以统计学的方式处理它们。通道预处理方法直接将焊点的每个片断堆叠起来。我们提出了三种深度学习结构，分别属于CNN、3D CNN和LSTM的范畴。在模型A中，切片在预处理过程中被合并，并根据切片的统计数据来提取特征。对于模型B和模型C，通道式预处理方法包含原始图像，所有切片的特征由CNN一起提取。对于模型D，每个片断的特征由一个CNN提取。提取的特征用LSTM模块组合在一起。在下面的章节中，将详细说明每种预处理方法和模型结构。

![image-20221009102511745](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221009102511745.png)

​																						表1 模型描述



## 预处理方法

​		要处理的两个问题是：切片的数量和有噪声的ROI。根据 "三维自动X射线检测 "一节中提到的AXI特性，不同的焊点有不同的切片数量，因为有些焊点可以通过深层成像来检测，而有些则需要深层和浅层成像。另一个问题是有些ROI是不正确的，它不能包围感兴趣的焊点区域。我们以不同的方式解决这两个问题，并提出两种预处理方法，即ROI掩膜预处理和Channel-wise预处理。



## ROI掩码预处理

​		在预处理步骤中，我们建议进行第三维填充、方差特征、ROI掩码和裁剪。我们对切片进行零值填充，添加方差特征图像，添加ROI掩码，并进行裁剪以生成三通道输入。

​		由于有不同数量的切片，为了纳入所有的切片信息，我们建议在第三维度上垫零，以达到最大的切片数量，如图5所示。垫零的原因是它给所有的焊点一个基线切片，这有助于下面的差异特征预处理。

![image-20221009102936697](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221009102936697.png)

​																								图5 第三维度的填充物

​		差异特征是通过计算第三维度上的像素间差异来提取的。在第三维度上的方差。方差特征的形式也是一个图像，这样在相应位置的每个像素是所有切片的亮度方差。通过引入方差特征图像，所有切片的信息都可以被使用。

​		一张图片上大多有一个以上的焊点，ROI是焊点位置的一个指标。由于一些ROI不可靠，不能包含整个焊点，因此不能用ROI正确地裁剪焊点补丁。因此，我们在输入中加入了一个ROI掩码来指示焊点的位置。

![image-20221009103240205](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221009103240205.png)

​		ROI掩膜预处理方法详见算法1。首先将切片在第三维上填充为零片，达到最大的切片数SLICEMAX，为提取方差特征做好准备。然后将第一个切片、方差特征和ROI掩码分别分配给三个通道。在通道3中，ROI掩码的密度ROIdensity根据经验设定为10。需要对这三个通道进行裁剪，以获得小的斑块。一方面，对于感兴趣的关节来说，一幅图像非常大，而且包含一些背景，会使检测过程恶化。另一方面，感兴趣的关节的邻近区域可以为检测提供信息。因此，包含感兴趣的关节以及邻近区域的小斑块从图像中裁剪出来是有帮助的。图像被裁剪成可以包含相邻焊点的斑块。对于每个X射线图像，我们在数据集中获得，补丁的数量取决于机器ROI的数量。例如，在 "三维自动X射线检测 "部分的图3a中，有六个感兴趣的焊点。因此，从该图像中切割出六个补丁。对于高焊点密度区域的小焊点，根据数据集的统计和专家的建议，裁剪的尺寸L CROP = 340像素。裁剪后的补丁可能包含邻近的焊点。区分感兴趣的焊点和相邻焊点的方法是ROI掩码，它是预处理方法中的通道3。ROI掩码通过突出原始ROI区域来帮助定位感兴趣的焊点。对于几个感兴趣的大焊点，根据放大的ROI长度对图像进行裁剪，裁剪系数为α，这是一个由专家提供的经验系数。裁剪策略是焊点中心优先，但焊点不一定在裁剪片的中心。从步骤17-23开始，如果裁剪的ROI在切片图像的范围之外，则对其进行校准。当裁剪区域在图像之外时，裁剪坐标会向中心移动，这样就不需要对原始图像进行填充。最后，根据裁剪ROI={cxmin, cxmax, cymin, cymax}对patchk进行裁剪，并调整为224×224，这是CNN模型结构的经验输入尺寸。

​		预处理的输出由三个通道组成，如图6所示。第一个通道是在 "三维自动X射线检查 "一节中提到的被称为 "切片00 "的共同基本切片。第二个通道是所有切片的方差，包括被填充的零值切片，第三个通道是ROI掩码。

![image-20221115085335049](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115085335049.png)

​																						图6 ROI掩码预处理样本



## 频道式预处理

​		与结合了ROI掩码和方差特征的ROI掩码预处理不同，我们提出了一种直接的预处理方法，即在送入模型前将所有通道方向的切片连接起来。

​		通道式预处理算法如算法2所示。首先，由于有不同数量的片子，零片子被填充到最大数量的SLICEMAX，在我们的例子中是六个。由于数据集不仅包括重点焊料，还包括周围的焊料以及背景，在预处理步骤中实施了基于ROI的裁剪，以减少输入的大小。裁剪长度cr opLength是根据放大的ROI长度以系数α获得的，在这种情况下，根据专家建议，它是1.5。然后根据步骤6-9计算出的裁剪ROI={cxmin, cxmax, cymin, cymax}来裁剪切片。与ROI掩码预处理方法不同的是，如果裁剪区域在切片si k之外，则在空白区域周围填充零。通过这种方式，感兴趣的焊点被置于中心位置，由于没有信息表明焊点的位置，这对检测更有利。最后，补丁patchk被调整为128×128，可以被下面几节提出的CNN结构有效利用。

​		预处理的输出由六个通道组成，如图7所示。每个通道代表焊点的一个片断。对于片数少于6个的片子，零星的片子被填充。

![image-20221115085711651](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115085711651.png)

![image-20221115085739782](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115085739782.png)

​																									图7 各个频道的预处理样本



## 深度学习模型结构

​		这项工作中提出了三种深度学习模型结构。第一个被设计成常规的CNN结构。第二种是基于3D卷积的设计，第三种是用LSTM模块设计。



## CNN结构

​		对于普通的CNN结构，使用带有激活函数的二维卷积从高维图像中提取特征，如公式（1）所示，其中C是输入特征通道大小，K是内核权重大小，b是偏置，σ是激活函数。神经网络的结构如表2所示。

![image-20221115090232924](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115090232924.png)

​																									表2 CNN结构

​		它由卷积层、批量归一化层、最大池化层和全局平均池化层组成。具体结构如图8所示。3×3核的参数大小不大，被用在所提结构的卷积层中。因为通过叠加3×3卷积，可以实现各种接收场[15]。随着结构深度的加深，参数变得更多，训练时间变得更长。批量归一化层被用来提高训练速度，因为每层的分布偏移问题被缓解了。其定义为公式(2)和公式(3)，其中μB和σ 2B是每批训练的平均值和方差，γ和β是训练参数[16]。引入了全局平均池化层[17]。它有助于减少以下全连接层中的大量参数，并有助于可视化特征图，这将在 "结果 "部分讨论。卷积层的核大小为3×3，这是捕获所有方向的最小尺寸[15]。它的输入通道大小被设计为3个用于ROI掩膜预处理，6个用于通道预处理。

![image-20221115090420686](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115090420686.png)



## 三维CNN结构

​		对于通道式预处理方法，由于在预处理阶段没有提取相关信息，对于CNN结构来说，增加通道间的特征提取更为合理。与二维卷积相比，三维卷积使用的是三维张量，对于第三维的特征提取更加灵活。三维卷积的定义为公式（4），其中K是内核权重的第一和第二维大小，与二维内核的含义相同，Q是内核权重的第三维大小。对于三维核，其第一和第二维度通常保持不变，提取空间特征，而第三维度的大小不一定相同。在三维卷积中，内核wi jq是一个三维张量，沿三条轴移动，提取输入的特征。C是输入特征通道大小，b是偏置，σ是激活函数。

![image-20221115090652666](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115090652666.png)

​																									图8 CNN结构



![image-20221115090730868](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115090730868.png)

​																						表3 3D CNN结构



​		一个焊点有多个切片，在预处理过程中，焊点切片沿第三维堆叠。三维CNN结构的设计是为了提取适合于预处理的特征。它详见表3。在前两个堆叠的三维卷积层中，内核在空间维度上是3×3，在第三维度上是2。3×3内核通常用于提取空间特征，通过堆叠，可以实现更大的感受野。在第三维中，核的大小为2，这意味着相邻的切片信息被集中。但提取并不局限于相邻的切片，因为核沿第三维移动并与每个切片进行卷积，就像它在二维空间一样。在下面两个堆叠的三维卷积层中，使用了3×3×1的内核，因为它需要适合前一层的输出特征。例如，第一个最大集合层的输出是60×60×1×32，这也是下面三维卷积层的输入。它的第三维是1，因此，三维核的第三维大小需要设计为1。除了三维卷积层，还引入了maxpooling和批量归一化层。在我们的案例中，三维CNN结构不仅从每个片断中提取空间特征，而且还保留了多个片断之间的关系。

![image-20221115090935488](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115090935488.png)



## 基于LSTM的结构

​		LSTM神经网络是递归神经网络中的一种，可以对输入序列进行建模。通过在LSTM模块中插入分别在公式（5）、（6）和（7）中定义的遗忘门、输入门和输出门，该模块单元可以实现丢弃、存储和激活最后一个时间戳状态的信息。模块单元的状态根据公式（4）更新。(8), (9)，所以它能够捕捉到顺序输入内的关系。而LSTM模块的最终输出被定义为公式（10）。模块内部的门不仅有助于记住相邻关系，而且有助于记住输入之间的长期关系。

![image-20221115091139614](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115091139614.png)

​																								图9 基于LSTM的结构图示

![image-20221115091223195](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115091223195.png)





![image-20221115091240340](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115091240340.png)

​																									表4 基于LSTM的结构



​		在我们的例子中，从00到05的片断是连续的输入。由于有六个片子，LSTM模块连续计算六次，直到所有的片子都处理完毕。专家比较了不同片区的焊点差异，其变化可以表明焊点的变形。因此，预计基于LSTM的模型结构可以捕捉到不同片区之间的关系，用于缺陷检测。

​		由于图像是高维度的输入，所以在送入LSTM之前，由CNN从每个片断中提取特征，如F i g. 9所述。从CNN中提取的特征的输出大小为2048×6。每个向量由每个片断的信息组成，维度为2048。LSTM的序列长度为6，因为六个片子组成了焊点，并共享一个标签。LSTM模块的输出是一个由两个全连接层组成的分类器，如表4所示，用于分类。LSTM的输出大小根据经验设计为2048，将六个连续的片断的信息挤压出来。该分类器由两个全连接层组成。引入Dropout是为了提高泛化性能。



## 实验和结果

​		我们使用Python Keras和TensorFlow来实现该方法，参数设置总结于表5。

Adam被用作我们的优化方法。权重使用Glorot均匀分布进行初始化，以获得更快的收敛，其中均匀分布的上下限是基于当前层的输入和输出单元数量[18]。激活函数是整顿的线性函数（ReLU）[9]。表1中模型A和模型B的学习率设置为1e-4。而表1中的模型C和模型D的学习率被设定为1e-5，衰减为1e-6。经过几次试验，从1e-2开始减少[9]，学习率根据每个模型的表现来设定。

这些模型的可训练参数总结在表6中。

![image-20221115091548510](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115091548510.png)

​																							表5 训练设置

![image-20221115091629564](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115091629564.png)

​																					表6 可训练的参数

## 数据集和度量

​		该数据集有两种形式，即图像数据集和巨型数据集。在图像数据集中，每个图像都是PCB某部分的灰度X射线图像，如图2所示。每张图像都是由图像路径唯一识别的。在巨型数据集中，它由信息组成，如图像路径、板号、片号、焊点类型、机器缺陷、ROI、标签等。每个焊点都可以通过图像路径和投资回报率来唯一地识别。每个样本是一个焊点，根据提议的预处理算法进行裁剪。我们注意到，专家将一个焊点的所有切片标记为有缺陷或无缺陷。单个片子是否有缺陷，没有颗粒度。

​		在我们的工作中，有两个问题需要解决。第一个问题是，不同的焊点的片数不同。在这个数据集中，不同的片数代表不同的模糊程度。但深度和切片的编号是一致的。最大的切片数是6片。有些焊点的片数不尽相同，被忽略的片数总是最后的片数。第二个问题是，机器提供的ROI是有噪音的。有些ROI是长方形的。ROI的一边穿过焊点。有些ROI从焊点的中心偏移，这也导致不能包围整个焊点。嘈杂的ROI通常发生在小的焊点上，错误的ROI小于100像素左右。

![image-20221115091908378](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115091908378.png)

​																									表7 数据集片断分布

![image-20221115091936201](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115091936201.png)

​																										表8 数据集统计

​		数据集的切片分布和正常缺陷率如表7所示，数据集的统计数字汇总于表8。训练数据集、验证数据集和测试数据集是根据电路板类型划分的，用于测试泛化性能。也就是说，测试阶段的电路板类型在训练模型时没有出现，以模拟真实世界的情况。由于验证数据集与测试数据集不同，如果验证数据集上的模型性能与测试数据集上的相似，其泛化性能就会更好。在真实世界的情况下，良性焊点远远多于缺陷焊点。在不平衡的数据集上进行训练会导致糟糕的性能，因为会有对多数类的偏见，这使得很难检测到少数类[19,20].为了处理数据不平衡的问题，我们对良性数据进行下采样以获得平衡的训练数据集。由于缺陷训练数据的绝对量非常大，而且数据集中有一些重复的模式，因此实施了下采样。在未来的工作中，可以进一步探索专门设计的数据增量方法，以获得更好的性能。

​		准确率是常用的指标之一。然而，在不平衡问题的条件下，由于测试数据包括大量的良性数据和少量的异常数据，准确性对于性能检查是不公平的。例如，一种方法可以将所有的焊点分类为良性，这将给出一个非常高的准确率。但它不能检测到任何有缺陷的焊点。相反，召回率、假阳性率（FPR）和接收器操作特征下的面积（AUROC）是常用的。

​		对于一个二元分类器，标记为正和负，给定一个实例有四个结果：真阳性（TP）；假阳性（FP）；假阴性（FN）；真阴性（TN）。真阳性率（TPR）被定义为发生在所有阳性样本中的正确阳性结果，这也被称为召回率。FPR被定义为发生在所有阴性样品中的不正确的阳性结果。在我们的案例中，缺陷焊点被定义为阳性样本，正常焊点被定义为阴性样本。召回率和FPR之间有一个权衡。在给定的召回率下，FPR越小越好。召回率和FPR是根据固定的识别阈值计算的。因此，它不能反映彼此之间的动态关系。

​		接收者操作特征（ROC）曲线是一个常用的工具，用于分析和可视化二元分类器的性能，因为其辨别阈值的变化导致了TPR和FPR之间的权衡。ROC曲线以FPR为横轴，以TPR为纵轴。图中的点描述了TPR和FPR之间的关系。具有左上角锥点的分类器具有更好的整体性能。ROC下的面积是AUROC，它衡量的是总体性能，而不考虑阈值。

​		与衡量TP和TN之和与实例总数之间比例的准确性指标相比，召回率、FPR和AUROC更为精确，因为它们考虑到了数据的不平衡类。



## 结果

​		四个模型的结果显示在表9中。从表中可以看出，在召回率和FPR之间存在着权衡。随着阈值的降低，该模型可以分别获得更高的召回率和FPR的增加。对于不同的模型，阈值有不同的影响。例如，对于模型A，当阈值为0.1时，在验证数据集上，其召回率=0.9376，而对于模型D，召回率=0.9826。

![image-20221115092432080](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115092432080.png)

​																									表9 模型性能

当模型从验证数据集泛化到测试数据集时，所有模型的召回率都有大约2-5%的下降。至于FPR，模型A和模型B有大约1-3%的增长，而模型C和模型D在从验证数据集生成到测试数据集时有增长和下降的统计数据。经验阈值可以根据验证数据集来选择。在表10中，考虑到使验证数据集的召回率=0.90的阈值，测试数据集的最高召回率=0.8836是由模型D实现的，下降幅度为2%∼。在四个模型中，当验证数据集的召回率=0.90时，模型D具有最好的检测泛化性能

​		图10中可以看到所提出的模型的整体性能。无论阈值如何，所有模型的表现都相似，AUROC从0.8916到0.9056不等。然而，四个模型之间有一些细微的差别。当召回率增加到1.00时，模型A和模型D以较低的FPR超过了其他两个模型。而随着召回率的降低，模型B和模型C以较低的FPR表现更好。

![image-20221115092857800](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115092857800.png)

​																					图10 ROI掩膜模型的整体性能

​		对于深度学习模型结构的比较，由于模型B、模型C和模型D共享相同的预处理方法（channel-wise预处理方法），三个模型之间的比较表明CNN结构、3D CNN结构和基于LSTM结构之间的性能比较。从图10可以看出，在模型B、模型C和模型D中，模型B在召回率较低时表现最好，而模型D在召回率较高时表现最好。

![image-20221115093039900](https://raw.githubusercontent.com/dalongmaot/arm_linux/main/imgs/image-20221115093039900.png)

​																									表10 阈值比较

​		对于预处理方法的比较，由于模型A和模型B共享相同的深度学习模型结构（CNN结构），模型A和模型B之间的比较表明ROI掩码预处理方法和通道明智预处理的性能比较。从图10来看，由于模型B在召回率较低时有较低的FPR，所以明智的通道预处理对低召回率更好。当召回率变高时，由于模型A有较低的FPR，ROI掩码预处理方法有更好的性能。

​		在现实中，一些工业要求是可以预期的，如召回率≥0.90和召回率≥0.95。

​		

































### 参考文献

1. Liukkonen M, Havia E, Hiltunen Y (2012) Computational intelligence in mass soldering of electronics-a survey. Expert Syst Appl 39(10):9928–9937

2.  Leinbach G, Oresjo S (2001) The why, where, what, how, and when of automated x-ray inspection. Agilent Technologies, Loveland, Colorado

3. Huang CY , Hong JH, Huang E (2019) Developing a machine vision inspection system for electronics failure analysis. IEEE Trans Compon Packag Manuf Technol 9(9):1912–1925       

   黄，洪建华，黄E（2019）开发了一种用于电子故障分析的机器视觉检测系统。IEEE Trans Compon Package Manuf Technol 9（9）：1912–1925

4. Gao H, Jin W, Y ang X, Kaynak O (2016) A line-based-clustering approach for ball grid array component inspection in surface-mount technology. IEEE Trans Ind Electron 64(4):3030–3038

   高H，金W，杨X，Kaynak O（2016）表面贴装技术中球栅阵列元件检测的基于线的聚类方法。IEEE Trans-Ind Electron 64（4）：3030–3038

5. Jin W, Lin W, Y ang X, Gao H (2017) Reference-free path-walking method for ball grid array inspection in surface mounting machines.IEEE Trans Ind Electron 64(8):6310–6318

   金，林，杨，高（2017）表面贴装机球栅阵列检测的参考自由路径行走法。IEEE Trans-Ind Electron 64（8）：6310–6318

6. Lu X, He Z, Su L, Fan M, Liu F, Liao G, Shi T (2018) Detection of micro solder balls using active thermography technology and k-means algorithm. IEEE Trans Ind Inf 14(12):5620–5628

   陆，何，苏，范，刘，廖，施（2018）利用主动热成像技术和k-means算法检测微焊球。IEEE Trans-Ind-Inf 14（12）：5620–56287.

7. Jewler SJ (2019) High resolution automatic X-Ray inspection for continuous monitoring of advanced package assembly. In: 2019 International wafer level packaging conference (IWLPC), pp 1–5.

   https://doi.org/10.23919/IWLPC.2019.8914113

   Jewler SJ（2019）用于连续监测先进封装组件的高分辨率自动X射线检测。2019年国际晶圆级封装会议（IWLPC），第1-5页。

8. Y ung LC (2018), Investigation of the solder void defect in IC semiconductor packaging by 3D computed tomography analysis.

   In: 2018 IEEE 20th Electronics packaging technology conference (EPTC), 2018, pp 886–889. https://doi.org/10.1109/EPTC.2018.

   8654370

   Y ung LC（2018），通过三维计算机断层扫描分析研究集成电路半导体封装中的焊料空洞缺陷。摘自：2018年IEEE第20届电子封装技术会议（EPTC），2018年，第886–889页。

9. 

